# High Throughput Configuration Example
# Optimized for high-volume log processing with multiple workers

<system>
  # Enable multi-worker mode
  workers 4
  root_dir /var/log/fluentd
</system>

<source>
  @type forward
  port 24224
  bind 0.0.0.0
</source>

<match **>
  @type tcp_mc

  # Load balanced servers (workers will distribute across them)
  <server>
    host 192.168.1.100
    port 5000
    name lb-server-1
  </server>

  <server>
    host 192.168.1.101
    port 5000
    name lb-server-2
  </server>

  # Optimized timeout settings
  connect_timeout 2s
  send_timeout 30s

  # Memory buffer with large chunk size for performance
  <buffer tag>
    @type memory
    chunk_limit_size 16MB
    chunk_limit_records 100000
    flush_interval 5s
    flush_mode interval
    flush_thread_count 4
    retry_type exponential_backoff
    retry_wait 1s
    retry_max_interval 30s
    retry_timeout 6h
    overflow_action drop_oldest_chunk
  </buffer>

  # Minimal injection for performance
  <inject>
    time_key @timestamp
    time_type string
    time_format %Y-%m-%dT%H:%M:%S.%NZ
  </inject>
</match>
