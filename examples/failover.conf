# Failover Configuration Example
# Configure multiple TCP endpoints with automatic failover

<source>
  @type forward
  port 24224
  bind 0.0.0.0
</source>

<match **>
  @type tcp_mc

  # Primary server
  <server>
    host 192.168.1.100
    port 5000
    name primary-server
  </server>

  # Secondary server (used if primary fails)
  <server>
    host 192.168.1.101
    port 5000
    name secondary-server
  </server>

  # Tertiary server (used if both primary and secondary fail)
  <server>
    host 192.168.1.102
    port 5000
    name tertiary-server
  </server>

  # Timeout settings
  connect_timeout 3s    # Fail fast to try next server
  send_timeout 30s

  # File-based buffer for reliability
  <buffer tag>
    @type file
    path /var/log/fluentd/buffer/tcp_mc
    flush_interval 5s
    flush_mode interval
    retry_type exponential_backoff
    retry_wait 2s
    retry_max_interval 120s
    retry_timeout 24h
    overflow_action block
  </buffer>

  # Include hostname in logs
  <inject>
    time_key timestamp
    time_type string
    time_format %Y-%m-%dT%H:%M:%S.%NZ
    hostname_key hostname
    tag_key tag
  </inject>
</match>
